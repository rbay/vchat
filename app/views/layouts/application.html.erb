<!DOCTYPE html>
<html>
<head>
  <title>Vchat</title>
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <script src="http://static.opentok.com/v0.91/js/TB.min.js"></script>

  <script type="text/javascript">
	var apiKey = "<%= @api_key %>";
    var sessionId = "<%= @session %>";
    var token = "<%= @token %>";						

    TB.setLogLevel(TB.DEBUG);

    var session = TB.initSession(sessionId);
    session.addEventListener('sessionConnected', sessionConnectedHandler);
    session.connect(apiKey, token);

    var publisher;

    function sessionConnectedHandler(event) {
      // Put my webcam in a div
      var publishProps = {height:240, width:320};
      publisher = TB.initPublisher(apiKey, 'myPublisherDiv', publishProps);
      // Send my stream to the session
      session.publish(publisher);
    }
  </script>  
  <%= csrf_meta_tags %>
</head>
<body>

<%= yield %>

</body>
</html>
